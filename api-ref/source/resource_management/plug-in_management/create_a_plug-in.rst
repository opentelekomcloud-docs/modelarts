:original_name: CreatePlugin.html

.. _CreatePlugin:

Create a Plug-in
================

Function
--------

This API is used to create plug-in instances.

URI
---

POST /v2/{project_id}/pools/{pool_name}/plugins

.. table:: **Table 1** Path Parameters

   +------------+-----------+--------+------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                              |
   +============+===========+========+==========================================================================================+
   | project_id | Yes       | String | Project ID. For details, see :ref:`Obtaining a Project ID and Name <modelarts_03_0147>`. |
   +------------+-----------+--------+------------------------------------------------------------------------------------------+
   | pool_name  | Yes       | String | Resource pool name.                                                                      |
   +------------+-----------+--------+------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Request body parameters

   +------------+-----------+-----------------------------------------------------------------------------+----------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type                                                                        | Description                                                                |
   +============+===========+=============================================================================+============================================================================+
   | apiVersion | Yes       | String                                                                      | API resource type. The value is fixed at **Plugin** and cannot be changed. |
   +------------+-----------+-----------------------------------------------------------------------------+----------------------------------------------------------------------------+
   | kind       | Yes       | String                                                                      | API version. The value is fixed at **v2** and cannot be changed.           |
   +------------+-----------+-----------------------------------------------------------------------------+----------------------------------------------------------------------------+
   | spec       | Yes       | :ref:`PluginSpec <en-us_topic_0000002340898574__request_pluginspec>` object | Detailed description of plug-in installation or upgrade.                   |
   +------------+-----------+-----------------------------------------------------------------------------+----------------------------------------------------------------------------+

.. _en-us_topic_0000002340898574__request_pluginspec:

.. table:: **Table 3** PluginSpec

   +-----------+-----------+-------------------------------------------------------------------------+------------------------------------------------+
   | Parameter | Mandatory | Type                                                                    | Description                                    |
   +===========+===========+=========================================================================+================================================+
   | template  | Yes       | :ref:`Template <en-us_topic_0000002340898574__request_template>` object | Template information of the plug-in instances. |
   +-----------+-----------+-------------------------------------------------------------------------+------------------------------------------------+

.. _en-us_topic_0000002340898574__request_template:

.. table:: **Table 4** Template

   +-----------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Mandatory | Type               | Description                                                                                                                                                                                                                                                                                                                                                         |
   +===========+===========+====================+=====================================================================================================================================================================================================================================================================================================================================================================+
   | name      | Yes       | String             | Name of the plug-in template to be installed, for example, **log-agent**.                                                                                                                                                                                                                                                                                           |
   +-----------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | version   | No        | String             | Version of the plug-in to be installed or upgraded.                                                                                                                                                                                                                                                                                                                 |
   +-----------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | inputs    | No        | Map<String,Object> | Plug-in template installation parameters (varying depending on the plug-in). During the plug-in upgrade, you need to specify all the installation parameters. If the parameters are not specified, the default values in the plug-in template are used. The current plug-in installation parameters can be obtained through the API for querying plug-in instances. |
   +-----------+-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Response Parameters
-------------------

**Status code: 200**

.. table:: **Table 5** Response body parameters

   +-----------------------+--------------------------------------------------------------------------------------+-----------------------------------+
   | Parameter             | Type                                                                                 | Description                       |
   +=======================+======================================================================================+===================================+
   | apiVersion            | String                                                                               | API version. Options:             |
   |                       |                                                                                      |                                   |
   |                       |                                                                                      | -  **v2**                         |
   +-----------------------+--------------------------------------------------------------------------------------+-----------------------------------+
   | kind                  | String                                                                               | Type of the plug-in instance.     |
   +-----------------------+--------------------------------------------------------------------------------------+-----------------------------------+
   | metadata              | :ref:`PluginMetadata <en-us_topic_0000002340898574__response_pluginmetadata>` object | Metadata of the plug-in instance. |
   +-----------------------+--------------------------------------------------------------------------------------+-----------------------------------+
   | spec                  | :ref:`PluginSpec <en-us_topic_0000002340898574__response_pluginspec>` object         | Plug-in instance details.         |
   +-----------------------+--------------------------------------------------------------------------------------+-----------------------------------+
   | status                | :ref:`PluginStatus <en-us_topic_0000002340898574__response_pluginstatus>` object     | Plug-in instance status.          |
   +-----------------------+--------------------------------------------------------------------------------------+-----------------------------------+

.. _en-us_topic_0000002340898574__response_pluginmetadata:

.. table:: **Table 6** PluginMetadata

   ================= ====== =============================
   Parameter         Type   Description
   ================= ====== =============================
   name              String Name of the plug-in instance.
   creationTimestamp String Creation time.
   ================= ====== =============================

.. _en-us_topic_0000002340898574__response_pluginspec:

.. table:: **Table 7** PluginSpec

   +-----------+--------------------------------------------------------------------------+------------------------------------------------+
   | Parameter | Type                                                                     | Description                                    |
   +===========+==========================================================================+================================================+
   | template  | :ref:`Template <en-us_topic_0000002340898574__response_template>` object | Template information of the plug-in instances. |
   +-----------+--------------------------------------------------------------------------+------------------------------------------------+

.. _en-us_topic_0000002340898574__response_template:

.. table:: **Table 8** Template

   +-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Type               | Description                                                                                                                                                                                                                                                                                                                                                         |
   +===========+====================+=====================================================================================================================================================================================================================================================================================================================================================================+
   | name      | String             | Name of the plug-in template to be installed, for example, **log-agent**.                                                                                                                                                                                                                                                                                           |
   +-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | version   | String             | Version of the plug-in to be installed or upgraded.                                                                                                                                                                                                                                                                                                                 |
   +-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | inputs    | Map<String,Object> | Plug-in template installation parameters (varying depending on the plug-in). During the plug-in upgrade, you need to specify all the installation parameters. If the parameters are not specified, the default values in the plug-in template are used. The current plug-in installation parameters can be obtained through the API for querying plug-in instances. |
   +-----------+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002340898574__response_pluginstatus:

.. table:: **Table 9** PluginStatus

   +-----------------------+--------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                                                                                             | Description                                                                                                                             |
   +=======================+==================================================================================================+=========================================================================================================================================+
   | phase                 | String                                                                                           | Plug-in instance status. Options:                                                                                                       |
   |                       |                                                                                                  |                                                                                                                                         |
   |                       |                                                                                                  | -  **Pending**: The plug-in is being installed.                                                                                         |
   |                       |                                                                                                  |                                                                                                                                         |
   |                       |                                                                                                  | -  **Running**: All of the plug-in instances are running. This specifies that the plug-in runs properly.                                |
   |                       |                                                                                                  |                                                                                                                                         |
   |                       |                                                                                                  | -  **Updating**: The plug-in is being updated.                                                                                          |
   |                       |                                                                                                  |                                                                                                                                         |
   |                       |                                                                                                  | -  **Abnormal**: The plug-in instances are abnormal and the plug-in cannot be used. You can click the status to view the failure cause. |
   |                       |                                                                                                  |                                                                                                                                         |
   |                       |                                                                                                  | -  **Deleting**: The plug-in is being deleted.                                                                                          |
   +-----------------------+--------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
   | version               | String                                                                                           | Version of the plug-in instances.                                                                                                       |
   +-----------------------+--------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
   | reason                | String                                                                                           | Details about the plug-in instance installation failure.                                                                                |
   +-----------------------+--------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
   | values                | String                                                                                           | Installation parameters of the plug-in instances. The parameters vary depending on the plug-in.                                         |
   +-----------------------+--------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+
   | resources             | Array of :ref:`PluginResources <en-us_topic_0000002340898574__response_pluginresources>` objects | Resources used by the plug-in instances.                                                                                                |
   +-----------------------+--------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002340898574__response_pluginresources:

.. table:: **Table 10** PluginResources

   +----------------+----------------------------------------------------------------------------------------+---------------------------------------------+
   | Parameter      | Type                                                                                   | Description                                 |
   +================+========================================================================================+=============================================+
   | involvedObject | :ref:`ObjectReference <en-us_topic_0000002340898574__response_objectreference>` object | Resource objects referenced by the plug-in. |
   +----------------+----------------------------------------------------------------------------------------+---------------------------------------------+
   | replicas       | Integer                                                                                | Number of replicas of the resource object.  |
   +----------------+----------------------------------------------------------------------------------------+---------------------------------------------+
   | limits         | Map<String,String>                                                                     | Limit on requested resources.               |
   +----------------+----------------------------------------------------------------------------------------+---------------------------------------------+
   | requests       | Map<String,String>                                                                     | Requested resources.                        |
   +----------------+----------------------------------------------------------------------------------------+---------------------------------------------+

.. _en-us_topic_0000002340898574__response_objectreference:

.. table:: **Table 11** ObjectReference

   +-----------------+--------+---------------------------------------------------------------------------------+
   | Parameter       | Type   | Description                                                                     |
   +=================+========+=================================================================================+
   | kind            | String | API type of the resource object, for example, **DaemonSet** and **Deployment**. |
   +-----------------+--------+---------------------------------------------------------------------------------+
   | apiVersion      | String | API version of the resource object.                                             |
   +-----------------+--------+---------------------------------------------------------------------------------+
   | namespace       | String | Namespace of the resource object.                                               |
   +-----------------+--------+---------------------------------------------------------------------------------+
   | name            | String | Name of the resource object.                                                    |
   +-----------------+--------+---------------------------------------------------------------------------------+
   | uid             | String | Unique ID of the resource object.                                               |
   +-----------------+--------+---------------------------------------------------------------------------------+
   | resourceVersion | String | Current version of the resource object.                                         |
   +-----------------+--------+---------------------------------------------------------------------------------+

**Status code: 400**

.. table:: **Table 12** Response body parameters

   ========== ====== ==============
   Parameter  Type   Description
   ========== ====== ==============
   error_code String Error code.
   error_msg  String Error message.
   ========== ====== ==============

Example Requests
----------------

This API is used to create plug-in instances.

.. code-block:: text

   POST https://{endpoint}/v2/{project_id}/pools/{pool_name}/plugins

   {
     "apiVersion" : "v2",
     "kind" : "Plugin",
     "spec" : {
       "template" : {
         "version" : "1.6.36",
         "name" : "node-local-dns"
       }
     }
   }

Example Responses
-----------------

**Status code: 200**

Request succeeded.

.. code-block::

   {
     "apiVersion" : "v2",
     "kind" : "Plugin",
     "spec" : {
       "template" : {
         "name" : "node-local-dns",
         "version" : "1.6.36",
         "inputs" : {
           "flavor" : {
             "description" : "High avaiable",
             "name" : "HA",
             "resources" : [ {
               "name" : "node-local-dns-admission-controller",
               "limitsCpu" : "250m",
               "requestsCpu" : "250m",
               "replicas" : 2,
               "limitsMem" : "512Mi",
               "requestsMem" : "512Mi"
             }, {
               "name" : "node-local-dns-cache",
               "limitsCpu" : "500m",
               "requestsCpu" : "25m",
               "limitsMem" : "512Mi",
               "requestsMem" : "5Mi"
             } ],
             "size" : "large"
           },
           "custom" : {
             "enable_dnsconfig_admission" : true,
             "nameserver" : "135.0.0.1",
             "ndots" : "8",
             "search" : "1321"
           }
         }
       }
     }
   }

**Status code: 400**

Bad request

.. code-block::

   {
     "error_code" : "ModelArts.50004000",
     "error_msg" : "Bad request."
   }

Status Codes
------------

=========== ==================
Status Code Description
=========== ==================
200         Request succeeded.
400         Bad request
=========== ==================

Error Codes
-----------

See :ref:`Error Codes <modelarts_03_0095>`.
