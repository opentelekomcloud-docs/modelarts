:original_name: UpdateService.html

.. _UpdateService:

Updating Service Configurations
===============================

Function
--------

This API is used to update configurations of a model service. It can also be used to start or stop a service.

URI
---

PUT /v1/{project_id}/services/{service_id}

.. table:: **Table 1** Path Parameters

   +------------+-----------+--------+------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                              |
   +============+===========+========+==========================================================================================+
   | project_id | Yes       | String | Project ID. For details, see :ref:`Obtaining a Project ID and Name <modelarts_03_0147>`. |
   +------------+-----------+--------+------------------------------------------------------------------------------------------+
   | service_id | Yes       | String | Service ID                                                                               |
   +------------+-----------+--------+------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Request header parameters

   +--------------+-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter    | Mandatory | Type   | Description                                                                                                                                                           |
   +==============+===========+========+=======================================================================================================================================================================+
   | X-Auth-Token | Yes       | String | User token. It can be obtained by calling the IAM API that is used to obtain a user token. The value of **X-Subject-Token** in the response header is the user token. |
   +--------------+-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. table:: **Table 3** Request body parameters

   +-----------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Mandatory | Type                                                                                                                                              | Description                                                                                                                                                                                                                                         |
   +=======================+===========+===================================================================================================================================================+=====================================================================================================================================================================================================================================================+
   | schedule              | No        | Array of :ref:`Schedule <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_schedule>` objects                                    | Service scheduling configuration, which can be configured only for real-time services. By default, this parameter is not used. Services run for a long time.                                                                                        |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | description           | No        | String                                                                                                                                            | Service description, which contains a maximum of 100 characters and cannot contain the following characters: <>=&"'. If this parameter is not set, no update is performed.                                                                          |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | config                | No        | Array of :ref:`ServiceConfig <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_serviceconfig>` objects                          | Service configuration. If this parameter is not configured, the service is not updated.                                                                                                                                                             |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | status                | No        | String                                                                                                                                            | Service status, which can be **running** or **stopped**. If this parameter is not configured, the service status is not changed. Either **status** or **config** can be modified. If both of them are used, modify **status** only.                 |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | additional_properties | No        | Map<String,\ :ref:`ServiceAdditionalProperties <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_serviceadditionalproperties>`> | Additional service attribute, which facilitates service management                                                                                                                                                                                  |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | load_balancer_policy  | No        | String                                                                                                                                            | Backend ELB forwarding policy that can be set only for synchronous real-time services. The value can be **ROUND_ROBIN** (weighted round robin), **LEAST_CONNECTIONS** (weighted least connections), or **SOURCE_IP** (source IP address algorithm). |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | service_secrets       | No        | Array of :ref:`ServiceSecret <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_servicesecret>` objects                          | List of keys mounted to the service. If this parameter is not set, no update is performed.                                                                                                                                                          |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | priority              | No        | Integer                                                                                                                                           | Preemption priority, value range [1, 3]. By setting the priority, high priority business scheduling is guaranteed.When **infer_type** is real-time or batch, preemption priority setting is supported.                                              |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_schedule:

.. table:: **Table 4** Schedule

   +-----------+-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Mandatory | Type    | Description                                                                                                                            |
   +===========+===========+=========+========================================================================================================================================+
   | duration  | Yes       | Integer | Value mapping a time unit. For example, if the task stops after two hours, set **time_unit** to **HOURS** and **duration** to **2**.   |
   +-----------+-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------+
   | time_unit | Yes       | String  | Scheduling time unit. Possible values are **DAYS**, **HOURS**, and **MINUTES**.                                                        |
   +-----------+-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------+
   | type      | Yes       | String  | Scheduling type. Currently, the value can only be stop, indicating that the task automatically stops after a specified period of time. |
   +-----------+-----------+---------+----------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_serviceconfig:

.. table:: **Table 5** ServiceConfig

   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                 | Mandatory       | Type                                                                                                                                          | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   +===========================+=================+===============================================================================================================================================+====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | custom_spec               | No              | :ref:`CustomSpec <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_customspec>` object                                      | Customized resource specification configuration. This parameter is returned only when specification is set to custom.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | envs                      | No              | Map<String,String>                                                                                                                            | Common parameter. (Optional) Environment variable key-value pair required for running a model. By default, this parameter is left blank.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | specification             | Yes             | String                                                                                                                                        | Common parameter. Resource flavor. You can query the supported service deployment flavors. The current version supports **modelarts.vm.cpu.2u**, **modelarts.vm.gpu.pnt004** (must be requested), **modelarts.vm.ai1.snt3** (must be requested), and **custom** (available only when the service is deployed in a dedicated resource pool). To request a flavor, obtain permissions from ModelArts O&M engineers. If this parameter is set to **custom**, the **custom_spec** parameter must be specified.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | weight                    | No              | Integer                                                                                                                                       | This parameter is mandatory for **real-time**. Weight of traffic allocated to a model. This parameter is mandatory only when **infer_type** is set to **real-time**. The sum of all weights must be equal to 100. If multiple model versions are configured with different traffic weights in a real-time service, ModelArts will continuously access the prediction API of the service and forward prediction requests to the model instances of the corresponding versions based on the weights.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | deploy_timeout_in_seconds | No              | Integer                                                                                                                                       | Timeout interval for deploying a single model instance                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | model_id                  | Yes             | String                                                                                                                                        | Common parameters Model ID. You can obtain the value by calling the API for querying the model list.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | src_path                  | No              | String                                                                                                                                        | Mandatory for batch services. OBS path to the input data of a batch job                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | req_uri                   | No              | String                                                                                                                                        | Mandatory for batch services. Inference API called in a batch task, which is the RESTful API exposed in the model image. You must select an API URL from the **config.json** file of the model for inference. If a built-in inference image of ModelArts is used, the API is displayed as **/**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | mapping_type              | No              | String                                                                                                                                        | The batch service type is mandatory. Mapping type of the input data. The value can be file or csv.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   |                           |                 |                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                           |                 |                                                                                                                                               | -  If file is selected, each inference request corresponds to a file in the input data directory. When this mode is used, req_uri corresponding to the model can have only one input parameter and the parameter type is file.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   |                           |                 |                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   |                           |                 |                                                                                                                                               | -  If csv is selected, each inference request corresponds to a row of data in the CSV file. If this mode is used, the file name extension in the input data directory must be .csv, and the mapping_rule parameter must be configured to indicate the CSV index corresponding to each parameter in the inference request body.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | cluster_id                | No              | String                                                                                                                                        | Resource pool ID used for deploying a service. This parameter is optional. For real-time and batch services, the value is the ID of the old-version dedicated resource pool. After this parameter is configured, the network configuration of the cluster is used and the **vpc_id** parameter does not take effect. When using a dedicated resource pool to deploy a service, ensure that the cluster status is normal and this parameter has a higher priority than **cluster_id**. When setting this parameter, you also need to set the **cluster_id** or **pool_name** parameter of the service level, and the priority of this parameter is higher than that of the **cluster_id** and **pool_name** parameters of the service level. If neither of the **cluster_id** and **pool_name** parameters is configured in **config**, the **cluster_id** and **pool_name** parameters of the service level are used. If none of them is configured, the shared resource pool is used. For edge services, the value is the edge resource pool ID. When using an edge resource pool to deploy a service, ensure that the resource pool status is normal. When setting this parameter, you also need to set the **cluster_id** parameter of the service level, and the priority of this parameter is higher than that of the **cluster_id** parameter of the service level. If this parameter is not set, the **cluster_id** parameter of the service level is used. |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | pool_name                 | No              | String                                                                                                                                        | Resource pool ID of the elastic cluster in the AI dedicated resource pool used for service deployment. When using a dedicated resource pool to deploy a service, ensure that the cluster status is normal and this parameter has a higher priority than **cluster_id**. When setting this parameter, you also need to set **cluster_id** or **pool_name** of the service level, and the priority of this parameter is higher than that of **cluster_id** and **pool_name** of the service level. If neither **cluster_id** nor **pool_name** is configured in **config**, the **cluster_id** and **pool_name** parameters of the service level are used. If none of them is configured, the shared resource pool is used. This parameter is optional for real-time and batch services.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | nodes                     | No              | Array of strings                                                                                                                              | Edge node ID array. The node ID is the edge node ID on IEF, which can be obtained after the edge node is created on IEF. This parameter is optional for edge services.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | mapping_rule              | No              | Object                                                                                                                                        | Optional for batch services. Mapping between input parameters and CSV data. This parameter is mandatory only when **mapping_type** is set to **csv**. The mapping rule is similar to the definition of the input parameters in the **config.json** file. You only need to configure the index parameters under each parameter of the string, number, integer, or boolean type, and specify the value of this parameter to the values of the index parameters in the CSV file to send an inference request. Use commas (,) to separate multiple pieces of CSV data. The values of the index parameters start from **0**. If the value of the index parameter is **-1**, ignore this parameter. For details, see the sample of creating a batch service.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | src_type                  | No              | String                                                                                                                                        | Mandatory for batch services. Data source type, which can be **ManifestFile**. By default, this parameter is left blank, indicating that only files in the **src_path** directory are read. If this parameter is set to **ManifestFile**, **src_path** must be set to a specific manifest path. Multiple data paths can be specified in the manifest file. For details, see the manifest inference specifications.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | dest_path                 | No              | String                                                                                                                                        | Mandatory for batch services. OBS path to the output data of a batch job                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | instance_count            | Yes             | Integer                                                                                                                                       | Common parameter. Number of instances deployed in a model. The maximum number of instances is 128. To use more instances, submit a service ticket.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | additional_properties     | No              | Map<String,\ :ref:`ModelAdditionalProperties <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_modeladditionalproperties>`> | Additional attributes for model deployment, facilitating service instance management                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | affinity                  | No              | :ref:`ServiceAffinity <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_serviceaffinity>` object                            | Service Affinity Deployment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
   +---------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_customspec:

.. table:: **Table 6** CustomSpec

   +-----------+-----------+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Mandatory | Type    | Description                                                                                                                                                                     |
   +===========+===========+=========+=================================================================================================================================================================================+
   | gpu_p4    | No        | Float   | Number of GPUs, which can be a decimal. The value cannot be smaller than 0, with the third decimal place is rounded off. This parameter is optional and is not used by default. |
   +-----------+-----------+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | memory    | Yes       | Integer | Memory in MB, which must be an integer                                                                                                                                          |
   +-----------+-----------+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | cpu       | Yes       | Float   | Number of CPU cores, which can be a decimal. The value cannot be smaller than 0.01, with the third decimal place is rounded off.                                                |
   +-----------+-----------+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_modeladditionalproperties:

.. table:: **Table 7** ModelAdditionalProperties

   +----------------------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter                        | Mandatory       | Type                                                                                                                             | Description                                                                                                                                                                                                                                                                                                                                 |
   +==================================+=================+==================================================================================================================================+=============================================================================================================================================================================================================================================================================================================================================+
   | log_volume                       | No              | Array of :ref:`LogVolume <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_logvolume>` objects                 | Host directory mounting.                                                                                                                                                                                                                                                                                                                    |
   |                                  |                 |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                             |
   |                                  |                 |                                                                                                                                  | This parameter takes effect only if a dedicated resource pool is used. If a public resource pool is used to deploy services, this parameter cannot be configured. Otherwise, an error will occur.                                                                                                                                           |
   +----------------------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | max_surge                        | No              | Float                                                                                                                            | The value must be greater than 0. If this parameter is not set, the default value 1 is used. If the value is less than 1, it indicates the percentage of instances to be added during the rolling upgrade. If the value is greater than 1, it indicates the maximum number of instances to be added during the rolling upgrade.             |
   +----------------------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | max_unavailable                  | No              | Float                                                                                                                            | The value must be greater than 0. If this parameter is not set, the default value 0 is used. If the value is less than 1, it indicates the percentage of instances that can be scaled in during the rolling upgrade. If the value is greater than 1, it indicates the number of instances that can be scaled in during the rolling upgrade. |
   +----------------------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | termination_grace_period_seconds | No              | Integer                                                                                                                          | Graceful stop period of a container.                                                                                                                                                                                                                                                                                                        |
   +----------------------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | persistent_volumes               | No              | Array of :ref:`PersistentVolumes <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_persistentvolumes>` objects | Persistent storage mounting.                                                                                                                                                                                                                                                                                                                |
   +----------------------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_logvolume:

.. table:: **Table 8** LogVolume

   ========== ========= ====== =================================
   Parameter  Mandatory Type   Description
   ========== ========= ====== =================================
   host_path  Yes       String Log path to be mapped on the host
   mount_path Yes       String Path to the logs in the container
   ========== ========= ====== =================================

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_persistentvolumes:

.. table:: **Table 9** PersistentVolumes

   +----------------+-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter      | Mandatory | Type   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   +================+===========+========+==================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | name           | No        | String | Volume name.                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
   +----------------+-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | mount_path     | Yes       | String | Mount path of a volume in the container. Example: /tmp. The container path must not be a system directory, such as / and /var/run. Otherwise, an exception occurs. It is a good practice to mount the container to an empty directory. If the directory is not empty, ensure that there are no files affecting container startup in the directory. Otherwise, such files will be replaced, resulting in failures to start the container and create the workload. |
   +----------------+-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | storage_type   | No        | String | Mount type: sfs_turbo.                                                                                                                                                                                                                                                                                                                                                                                                                                           |
   +----------------+-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | source_address | No        | String | Specifies the mounting source path. The value is the SFS Turbo ID when an EFS file is mounted.                                                                                                                                                                                                                                                                                                                                                                   |
   +----------------+-----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_serviceaffinity:

.. table:: **Table 10** ServiceAffinity

   +---------------+-----------+--------------------------------------------------------------------------------------------------------------+------------------------------------------------+
   | Parameter     | Mandatory | Type                                                                                                         | Description                                    |
   +===============+===========+==============================================================================================================+================================================+
   | node_affinity | No        | :ref:`NodeAffinity <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_nodeaffinity>` object | Set this parameter when node affinity is used. |
   +---------------+-----------+--------------------------------------------------------------------------------------------------------------+------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_nodeaffinity:

.. table:: **Table 11** NodeAffinity

   +------------+-----------+--------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type                                                                                                                           | Description                                                                                                                                                                                                                                                                                                                                                                                                         |
   +============+===========+================================================================================================================================+=====================================================================================================================================================================================================================================================================================================================================================================================================================+
   | mode       | Yes       | String                                                                                                                         | Node affinity mode. The value required indicates strong affinity. A service instance can be scheduled only to a specified node. If the specified node does not exist, the scheduling fails. preferred indicates weak affinity. A service instance tends to be scheduled to a specified node. If the specified node does not meet the scheduling conditions, the service instance will be scheduled to another node. |
   +------------+-----------+--------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | pool_infos | No        | Array of :ref:`AffinityPoolInfo <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_affinitypoolinfo>` objects | Configure an affinity policy for a specified cluster and specify the nodes in the cluster.                                                                                                                                                                                                                                                                                                                          |
   +------------+-----------+--------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_affinitypoolinfo:

.. table:: **Table 12** AffinityPoolInfo

   +-----------+-----------+--------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------+
   | Parameter | Mandatory | Type                                                                                                                           | Description                                                    |
   +===========+===========+================================================================================================================================+================================================================+
   | pool_name | Yes       | String                                                                                                                         | Cluster name. The cluster name must be in the outer pool_name. |
   +-----------+-----------+--------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------+
   | nodes     | Yes       | Array of :ref:`AffinityNodeInfo <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_affinitynodeinfo>` objects | Affinity Node List                                             |
   +-----------+-----------+--------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_affinitynodeinfo:

.. table:: **Table 13** AffinityNodeInfo

   +-----------+-----------+--------+---------------------------------------------------------------------+
   | Parameter | Mandatory | Type   | Description                                                         |
   +===========+===========+========+=====================================================================+
   | name      | Yes       | String | Node name, which corresponds to the private IP address of the node. |
   +-----------+-----------+--------+---------------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_serviceadditionalproperties:

.. table:: **Table 14** ServiceAdditionalProperties

   +---------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter           | Mandatory       | Type                                                                                                                             | Description                                                                                                                                                                                           |
   +=====================+=================+==================================================================================================================================+=======================================================================================================================================================================================================+
   | smn_notification    | Yes             | Map<String,\ :ref:`SmnNotification <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_smnnotification>`>        | SMN message notification structure, which is used to notify the user of the service status change                                                                                                     |
   +---------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_report_channels | No              | Array of :ref:`LogReportPipeline <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_logreportpipeline>` objects | Log channel group. If this parameter is not specified or the array length is 0, LTS log interconnection is disabled. This function cannot be modified after being enabled.                            |
   +---------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | websocket_upgrade   | No              | Boolean                                                                                                                          | Whether the service interface is upgraded to WebSocket. During service deployment, the default value is **false**. During service configuration update, the default value is the value set last time. |
   |                     |                 |                                                                                                                                  |                                                                                                                                                                                                       |
   |                     |                 |                                                                                                                                  | -  **false**: Do not upgrade to WebSocket.                                                                                                                                                            |
   |                     |                 |                                                                                                                                  |                                                                                                                                                                                                       |
   |                     |                 |                                                                                                                                  | -  **true**: Upgrade to WebSocket. This parameter cannot be modified after WebSocket is enabled. WebSocket cannot be enabled together with **Traffic Limit**.                                         |
   +---------------------+-----------------+----------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_smnnotification:

.. table:: **Table 15** SmnNotification

   +-----------------+-----------------+-------------------+---------------------------------------+
   | Parameter       | Mandatory       | Type              | Description                           |
   +=================+=================+===================+=======================================+
   | topic_urn       | Yes             | String            | URN of an SMN topic                   |
   +-----------------+-----------------+-------------------+---------------------------------------+
   | events          | Yes             | Array of integers | Event ID. The options are as follows: |
   |                 |                 |                   |                                       |
   |                 |                 |                   | -  **1**: failed                      |
   |                 |                 |                   |                                       |
   |                 |                 |                   | -  **3**: running                     |
   |                 |                 |                   |                                       |
   |                 |                 |                   | -  **7**: concerning                  |
   |                 |                 |                   |                                       |
   |                 |                 |                   | -  **11**: pending                    |
   +-----------------+-----------------+-------------------+---------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_logreportpipeline:

.. table:: **Table 16** LogReportPipeline

   +---------------+-----------+----------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------+
   | Parameter     | Mandatory | Type                                                                                                                 | Description                                              |
   +===============+===========+======================================================================================================================+==========================================================+
   | type          | Yes       | String                                                                                                               | Log pipeline type. Currently, only **LTS** is supported. |
   +---------------+-----------+----------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------+
   | configuration | No        | :ref:`LtsConfiguration <en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_ltsconfiguration>` object | LTS log configuration.                                   |
   +---------------+-----------+----------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_ltsconfiguration:

.. table:: **Table 17** LtsConfiguration

   +---------------+-----------+--------+------------------------------------------------------+
   | Parameter     | Mandatory | Type   | Description                                          |
   +===============+===========+========+======================================================+
   | log_group_id  | Yes       | String | LTS log group ID. The value contains 64 characters.  |
   +---------------+-----------+--------+------------------------------------------------------+
   | log_stream_id | Yes       | String | LTS log stream ID. The value contains 64 characters. |
   +---------------+-----------+--------+------------------------------------------------------+

.. _en-us_topic_0000002268726249__en-us_topic_0000002055322470_request_servicesecret:

.. table:: **Table 18** ServiceSecret

   ========= ========= ====== ===========
   Parameter Mandatory Type   Description
   ========= ========= ====== ===========
   secretId  Yes       String Key id
   mouthPath Yes       String Mount path
   ========= ========= ====== ===========

Response Parameters
-------------------

None

Example Requests
----------------

The following shows how to update a real-time service.

.. code-block:: text

   PUT https://{endpoint}/v1/{project_id}/services/{service_id}

   {
     "description" : "",
     "status" : "running",
     "config" : [ {
       "model_id" : "xxxx",
       "weight" : "100",
       "specification" : "modelarts.vm.cpu.2u",
       "instance_count" : 1
     } ]
   }

Example Responses
-----------------

**Status code: 200**

The service is updated.

.. code-block::

   { }

Status Codes
------------

=========== =======================
Status Code Description
=========== =======================
200         The service is updated.
=========== =======================

Error Codes
-----------

See :ref:`Error Codes <modelarts_03_0095>`.
