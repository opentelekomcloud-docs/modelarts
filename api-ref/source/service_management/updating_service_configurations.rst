:original_name: UpdateService.html

.. _UpdateService:

Updating Service Configurations
===============================

Function
--------

This API is used to update configurations of a model service. It can also be used to start or stop a service.

Debugging
---------

You can debug this API through automatic authentication in or use the SDK sample code generated by API Explorer.

URI
---

PUT /v1/{project_id}/services/{service_id}

.. table:: **Table 1** Path Parameters

   +------------+-----------+--------+------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                              |
   +============+===========+========+==========================================================================================+
   | project_id | Yes       | String | Project ID. For details, see :ref:`Obtaining a Project ID and Name <modelarts_03_0147>`. |
   +------------+-----------+--------+------------------------------------------------------------------------------------------+
   | service_id | Yes       | String | Service ID                                                                               |
   +------------+-----------+--------+------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 2** Request header parameters

   +--------------+-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter    | Mandatory | Type   | Description                                                                                                                                                           |
   +==============+===========+========+=======================================================================================================================================================================+
   | X-Auth-Token | Yes       | String | User token. It can be obtained by calling the IAM API that is used to obtain a user token. The value of **X-Subject-Token** in the response header is the user token. |
   +--------------+-----------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. table:: **Table 3** Request body parameters

   +-----------------------+-----------+---------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Mandatory | Type                                                                                        | Description                                                                                                                                                                                                                         |
   +=======================+===========+=============================================================================================+=====================================================================================================================================================================================================================================+
   | schedule              | No        | Array of :ref:`Schedule <en-us_topic_0000001943967241__request_schedule>` objects           | Service scheduling configuration, which can be configured only for real-time services. By default, this parameter is not used. Services run for a long time.                                                                        |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | description           | No        | String                                                                                      | Service description, which contains a maximum of 100 characters. If this parameter is not configured, the service description is not updated.                                                                                       |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | config                | No        | Array of :ref:`ServiceConfig <en-us_topic_0000001943967241__request_serviceconfig>` objects | Service configuration. If this parameter is not configured, the service is not updated.                                                                                                                                             |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | status                | No        | String                                                                                      | Service status, which can be **running** or **stopped**. If this parameter is not configured, the service status is not changed. Either **status** or **config** can be modified. If both of them are used, modify **status** only. |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | additional_properties | No        | Map<String,String>                                                                          | Additional service attribute, which facilitates service management                                                                                                                                                                  |
   +-----------------------+-----------+---------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000001943967241__request_schedule:

.. table:: **Table 4** Schedule

   +-----------+-----------+---------+--------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter | Mandatory | Type    | Description                                                                                                                          |
   +===========+===========+=========+======================================================================================================================================+
   | duration  | Yes       | Integer | Value mapping a time unit. For example, if the task stops after two hours, set **time_unit** to **HOURS** and **duration** to **2**. |
   +-----------+-----------+---------+--------------------------------------------------------------------------------------------------------------------------------------+
   | time_unit | Yes       | String  | Scheduling time unit. Possible values are **DAYS**, **HOURS**, and **MINUTES**.                                                      |
   +-----------+-----------+---------+--------------------------------------------------------------------------------------------------------------------------------------+
   | type      | Yes       | String  | Scheduling type. Only the value **stop** is supported.                                                                               |
   +-----------+-----------+---------+--------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000001943967241__request_serviceconfig:

.. table:: **Table 5** ServiceConfig

   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Mandatory | Type                                                                                                             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
   +=======================+===========+==================================================================================================================+========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
   | custom_spec           | No        | :ref:`CustomSpec <en-us_topic_0000001943967241__request_customspec>` object                                      | Custom resource specifications                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | envs                  | No        | Map<String,String>                                                                                               | Common parameter. (Optional) Environment variable key-value pair required for running a model. By default, this parameter is left blank.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | specification         | Yes       | String                                                                                                           | Common parameter. Resource flavors, which are **modelarts.vm.cpu.2u**, **modelarts.vm.gpu.p4** (must be requested for), **modelsarts.vm.ai1.a310** (must be requested for), and **custom** (available only when the service is deployed in a dedicated resource pool) in the current version. To request for a flavor, obtain permissions from ModelArts O&M engineers. If this parameter is set to **custom**, the **custom_spec** parameter must be specified.                                                                                                                                                                                                                                                                                       |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | weight                | No        | Integer                                                                                                          | This parameter is mandatory for **real-time**. Weight of traffic allocated to a model. This parameter is mandatory only when **infer_type** is set to **real-time**. The sum of all weights must be equal to 100. If multiple model versions are configured with different traffic weights in a real-time service, ModelArts will continuously access the prediction API of the service and forward prediction requests to the model instances of the corresponding versions based on the weights.                                                                                                                                                                                                                                                     |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | model_id              | Yes       | String                                                                                                           | Common parameter. Model ID, which can be obtained by calling the API for obtaining a model list.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | src_path              | No        | String                                                                                                           | Mandatory for batch services. OBS path to the input data of a batch job                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | req_uri               | No        | String                                                                                                           | Mandatory for batch services. Inference API called in a batch task, which is the RESTful API exposed in the model image. You must select an API URL from the **config.json** file of the model for inference. If a built-in inference image of ModelArts is used, the API is displayed as **/**.                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | mapping_type          | No        | String                                                                                                           | Mandatory for batch services. Mapping type of the input data. The value can be **file** or **csv**. **file** indicates that each inference request corresponds to a file in the input data directory. If this parameter is set to **file**, **req_uri** of the model can have only one input parameter and the type of this parameter is **file**. If this parameter is set to **csv**, each inference request corresponds to a row of data in the CSV file. When **csv** is used, the file in the input data directory can only be suffixed with .csv, and the **mapping_rule** parameter must be configured to map the index of each parameter in the inference request body to the CSV file.                                                        |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | cluster_id            | No        | String                                                                                                           | Optional for real-time services. ID of a dedicated resource pool. This parameter is left blank by default, indicating that no dedicated resource pool is used. When using a dedicated resource pool to deploy services, ensure that the resource pool is running properly. After this parameter is configured, the network configuration of the cluster is used, and the **vpc_id** parameter does not take effect.                                                                                                                                                                                                                                                                                                                                    |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | pool_name             | No        | String                                                                                                           | Specifies the ID of the new dedicated resource pool. By default, this parameter is left blank, indicating that the dedicated resource pool is not used. This parameter corresponds to the ID of the new resource pool. When using dedicated resource pool to deploy services, ensure that the cluster status is normal. If pool_name in real-time config and pool_name in real-time config are configured at the same time, pool_name in real-time config is preferred.                                                                                                                                                                                                                                                                                |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | nodes                 | No        | Array of strings                                                                                                 | Mandatory for edge services. Edge node ID array. The node ID is the edge node ID on IEF, which can be obtained after the edge node is created on IEF.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | mapping_rule          | No        | Object                                                                                                           | Optional for batch services. Mapping between input parameters and CSV data. This parameter is mandatory only when **mapping_type** is set to **csv**. The mapping rule is similar to the definition of the input parameters in the **config.json** file. You only need to configure the index parameters under each parameter of the string, number, integer, or boolean type, and specify the value of this parameter to the values of the index parameters in the CSV file to send an inference request. Use commas (,) to separate multiple pieces of CSV data. The values of the index parameters start from **0**. If the value of the index parameter is **-1**, ignore this parameter. For details, see the sample of creating a batch service. |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | src_type              | No        | String                                                                                                           | Mandatory for batch services. Data source type, which can be **ManifestFile**. By default, this parameter is left blank, indicating that only files in the **src_path** directory are read. If this parameter is set to **ManifestFile**, **src_path** must be set to a specific manifest path. Multiple data paths can be specified in the manifest file. For details, see the manifest inference specifications.                                                                                                                                                                                                                                                                                                                                     |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | dest_path             | No        | String                                                                                                           | Mandatory for batch services. OBS path to the output data of a batch job                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | instance_count        | Yes       | Integer                                                                                                          | Common parameter. Number of instances deployed for a model. The maximum number of instances is 5. To use more instances, submit a service ticket.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | additional_properties | No        | Map<String,\ :ref:`ModelAdditionalProperties <en-us_topic_0000001943967241__request_modeladditionalproperties>`> | Additional attributes for model deployment, facilitating service instance management                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
   +-----------------------+-----------+------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000001943967241__request_customspec:

.. table:: **Table 6** CustomSpec

   +-------------+-----------+---------+------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter   | Mandatory | Type    | Description                                                                                                                        |
   +=============+===========+=========+====================================================================================================================================+
   | gpu_p4      | No        | Float   | (Optional) Number of GPU cores, which can be a decimal. The value cannot be smaller than 0, which allows up to two decimal places. |
   +-------------+-----------+---------+------------------------------------------------------------------------------------------------------------------------------------+
   | memory      | Yes       | Integer | Memory in MB, which must be an integer                                                                                             |
   +-------------+-----------+---------+------------------------------------------------------------------------------------------------------------------------------------+
   | cpu         | Yes       | Float   | Number of CPU cores, which can be a decimal. The value cannot be smaller than 0.01.                                                |
   +-------------+-----------+---------+------------------------------------------------------------------------------------------------------------------------------------+
   | ascend_a310 | No        | Integer | Number of Ascend chips. This parameter is optional and is not used by default. Either this parameter or **gpu_p4** is configured.  |
   +-------------+-----------+---------+------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000001943967241__request_modeladditionalproperties:

.. table:: **Table 7** ModelAdditionalProperties

   +--------------------+-----------+-------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter          | Mandatory | Type                                                                                                  | Description                                                                                                                                                                                                                |
   +====================+===========+=======================================================================================================+============================================================================================================================================================================================================================+
   | persistent_volumes | Yes       | Array of :ref:`persistent_volumes <en-us_topic_0000001943967241__request_persistent_volumes>` objects | Persistent storage mounting                                                                                                                                                                                                |
   +--------------------+-----------+-------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | log_volume         | Yes       | Array of :ref:`log_volume <en-us_topic_0000001943967241__request_log_volume>` objects                 | Host directory mounting. This parameter takes effect only if a dedicated resource pool is used. If a public resource pool is used to deploy services, this parameter cannot be configured. Otherwise, an error will occur. |
   +--------------------+-----------+-------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _en-us_topic_0000001943967241__request_persistent_volumes:

.. table:: **Table 8** persistent_volumes

   ========== ========= ====== =======================================
   Parameter  Mandatory Type   Description
   ========== ========= ====== =======================================
   name       Yes       String Image name
   mount_path Yes       String Mount path of an image in the container
   ========== ========= ====== =======================================

.. _en-us_topic_0000001943967241__request_log_volume:

.. table:: **Table 9** log_volume

   ========== ========= ====== =================================
   Parameter  Mandatory Type   Description
   ========== ========= ====== =================================
   host_path  Yes       String Log path to be mapped on the host
   mount_path Yes       String Path to the logs in the container
   ========== ========= ====== =================================

Response Parameters
-------------------

None

Example Requests
----------------

The following shows how to update a real-time service.

.. code-block:: text

   PUT https://{endpoint}/v1/{project_id}/services/{service_id}

   {
     "description" : "",
     "status" : "running",
     "config" : [ {
       "model_id" : "xxxx",
       "weight" : "100",
       "specification" : "modelarts.vm.cpu.2u",
       "instance_count" : 1
     } ]
   }

Example Responses
-----------------

**Status code: 200**

Service updated.

.. code-block::

   { }

Status Codes
------------

=========== ================
Status Code Description
=========== ================
200         Service updated.
=========== ================

Error Codes
-----------

See :ref:`Error Codes <modelarts_03_0095>`.
