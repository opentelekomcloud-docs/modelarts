:original_name: inference-modelarts-0018.html

.. _inference-modelarts-0018:

Deploying as a Real-Time Service
================================

After a model is prepared, you can deploy the model as a real-time service and predict and call the service.

Constraints
-----------

A maximum of 20 real-time services can be deployed by a user.

Prerequisites
-------------

-  Data has been prepared. Specifically, you have created a model in the **Normal** state in ModelArts.

Note
----

Real-time services deployed using the public resource pool also occupy quota resources when the services are **Abnormal** or **Stopped**. If the quota is insufficient and no more services can be deployed, delete some abnormal services to release resources.

Quota calculation:

-  If a dedicated resource pool is used to deploy real-time services, the quota is not decreased. The quota is increased or decreased only when the dedicated pool is created, modified, or deleted.
-  When a shared resource pool is used to deploy a real-time service, the quota will be increased or decreased when you create, change the number of, or delete instances.

Metering calculation:

-  If a real-time service is deployed using a dedicated pool, only the data of the dedicated pool to which the service belongs is metered.
-  When a shared pool is used to deploy a real-time service, the specifications used by the service will be metered.

Procedure
---------

#. Log in to the ModelArts management console. In the left navigation pane, choose **Service Deployment** > **Real-Time Services**. By default, the system switches to the **Real-Time Services** page.

#. In the real-time service list, click **Deploy** in the upper left corner. The **Deploy** page is displayed.

#. Set parameters for a real-time service.

   a. Set basic information about model deployment. For details about the parameters, see :ref:`Table 1 <en-us_topic_0000002374850213__en-us_topic_0165025304_table16373156155613>`.

      .. _en-us_topic_0000002374850213__en-us_topic_0165025304_table16373156155613:

      .. table:: **Table 1** Basic parameters of model deployment

         +-------------+----------------------------------------------------------------+
         | Parameter   | Description                                                    |
         +=============+================================================================+
         | Name        | Name of the real-time service. Set this parameter as prompted. |
         +-------------+----------------------------------------------------------------+
         | Description | Brief description of the real-time service.                    |
         +-------------+----------------------------------------------------------------+

   b. Enter key information including the resource pool and model configurations. For details, see :ref:`Table 2 <en-us_topic_0000002374850213__en-us_topic_0165025304_table10352134481117>`.

      .. _en-us_topic_0000002374850213__en-us_topic_0165025304_table10352134481117:

      .. table:: **Table 2** Parameters

         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Parameter                     | Sub-Parameter                       | Description                                                                                                                                                                                                                                                                                         |
         +===============================+=====================================+=====================================================================================================================================================================================================================================================================================================+
         | Resource Pool                 | Public resource pools               | Instances in the public resource pool can be of the CPU or GPU type.                                                                                                                                                                                                                                |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Resource Pool                 | Dedicated resource pools            | Select a specification from the dedicated resource pool specifications.                                                                                                                                                                                                                             |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | .. note::                                                                                                                                                                                                                                                                                           |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  The data of old-version dedicated resource pools will be gradually migrated to the new-version dedicated resource pools.                                                                                                                                                                      |
         |                               |                                     |    -  For new users and the existing users who have migrated data from old-version dedicated resource pools to new ones, there is only one entry to new-version dedicated resource pools on the ModelArts management console.                                                                       |
         |                               |                                     |    -  For the existing users who have not migrated data from old-version dedicated resource pools to new ones, there are two entries to dedicated resource pools on the ModelArts management console, where the entry marked with **New** is to the new version.                                    |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    For more details about the new-version dedicated resource pools, see :ref:`Comprehensive Upgrades to ModelArts Resource Pool Management Functions <resmgmt-modelarts_0002>`.                                                                                                                     |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | **Multi-Pool Load Balancing** | N/A                                 | After this function is enabled, the service will be deployed in two dedicated resource pools, and service traffic will be evenly distributed among the pools through a load balancer. This minimizes the impact on the service after one resource pool fails, improving service reliability.        |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | After this function is enabled, the number of compute nodes must be a multiple of 2 and the minimum value is **2**.                                                                                                                                                                                 |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | .. note::                                                                                                                                                                                                                                                                                           |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  Multi-pool load balancing is supported only when a dedicated resource pool is selected.                                                                                                                                                                                                       |
         |                               |                                     |    -  Multi-pool load balancing requires that the compute nodes in the two resource pools have the same specifications.                                                                                                                                                                             |
         |                               |                                     |    -  Both resource pools must be old or new resource pools.                                                                                                                                                                                                                                        |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Model and Configuration       | Model Source                        | Select **Model Management** based on your requirements.                                                                                                                                                                                                                                             |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         |                               | Model and Version                   | Select the model and version that are in the **Normal** state.                                                                                                                                                                                                                                      |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         |                               | Traffic Ratio (%)                   | Set the traffic proportion of the current instance node. Service calling requests are allocated to the current version based on this proportion.                                                                                                                                                    |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | If you deploy only one version of a model, set this parameter to **100%**. If you select multiple versions for gated launch, ensure that the sum of the traffic ratios of multiple versions is **100%**.                                                                                            |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         |                               | Specifications                      | Select available specifications based on the list displayed on the console. The specifications in gray cannot be used in the current environment.                                                                                                                                                   |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | If specifications in the public resource pools are unavailable, no public resource pool is available in the current environment. In this case, use a dedicated resource pool or contact the administrator to create a public resource pool.                                                         |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | .. note::                                                                                                                                                                                                                                                                                           |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    When the selected flavor is used to deploy the service, necessary system consumption is generated. Therefore, the resources actually occupied by the service are slightly greater than the selected flavor.                                                                                      |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         |                               | Compute Nodes                       | Set the number of instances for the current model version. If you set **Instances** to **1**, the standalone computing mode is used. If you set **Instances** to a value greater than 1, the distributed computing mode is used. Select a computing mode based on the actual requirements.          |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         |                               | Environment Variable                | Set environment variables and inject them to the pod. To ensure data security, do not enter sensitive information in environment variables.                                                                                                                                                         |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         |                               | Timeout                             | Timeout of a single model, including both the deployment and startup time. The default value is 20 minutes. The value must range from 3 to 120.                                                                                                                                                     |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         |                               | Mount Storage                       | This function will mount a storage volume to compute nodes (compute instances) as a local directory when the service is running. It is recommended when the model or input data is large.                                                                                                           |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | **OBS Bucket**                                                                                                                                                                                                                                                                                      |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | -  **Source Path**: Select an OBS bucket path. Cross-region OBS buckets cannot be selected. You can add up to 10 paths.                                                                                                                                                                             |
         |                               |                                     | -  **Mount Path**: Enter the container mount path, for example, **/obs-mount/**. It is good practice to create a directory. Avoid using inventory directories or system directories with strict permissions.                                                                                        |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | **OBS parallel file system**                                                                                                                                                                                                                                                                        |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | -  **Source Path**: Select the storage path of the parallel file. A cross-region OBS parallel file system cannot be selected.                                                                                                                                                                       |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | -  **Mount Path**: Enter the container mount path, for example, **/obs-mount/**.                                                                                                                                                                                                                    |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  Select a new directory. If an inventory directory is selected, the inventory files in it will be overwritten.                                                                                                                                                                                 |
         |                               |                                     |    -  It is a good practice to mount the container to an empty directory. If the directory is not empty, ensure that there are no files affecting container startup in the directory. Otherwise, such files will be replaced, resulting in failures to start the container and create the workload. |
         |                               |                                     |    -  The mount path must start with a slash (/) and can contain a maximum of 1,024 characters, including letters, digits, and the following special characters: \\_-.                                                                                                                              |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    **SFS Turbo**                                                                                                                                                                                                                                                                                    |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  **File System Name**: Select the target SFS Turbo file system. A cross-region SFS Turbo file system cannot be selected.                                                                                                                                                                       |
         |                               |                                     |    -  **Mount Path**: Enter the mount path of the container, for example, **/sfs-turbo-mount/**. Select a new directory. If you select an existing directory, any existing files within it will be replaced.                                                                                        |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | .. note::                                                                                                                                                                                                                                                                                           |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  A file system can be mounted only once and to only one path. Each mount path must be unique. At most 10 disks can be mounted to an OBS bucket.                                                                                                                                                |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  Storage mounting is allowed only for services deployed in a dedicated resource pool which has interconnected with a VPC or associated with SFS Turbo.                                                                                                                                         |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |       To interconnect a VPC is to interconnect the VPC where SFS Turbo belongs to a dedicated resource pool network. For details, see :ref:`Interconnect with a VPC <en-us_topic_0000002340890628__section1473914311415>`.                                                                          |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  Once you have chosen SFS Turbo, avoid deleting the interconnected VPC or disassociating SFS Turbo. Otherwise, mounting will not be possible. When you mount the backend OBS storage on the SFS Turbo page, make sure to set the client's umask permission to 777 for normal use.              |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  If you need to mount multiple files, do not use the paths that are the same or similar, for example, **/obs-mount/** and **/obs-mount/tmp/**.                                                                                                                                                 |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  When an OBS parallel file system is mounted, a policy is configured for the bucket. Do not delete the policy.                                                                                                                                                                                 |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         |                               | Add Model Version and Configuration | If the selected model has multiple versions, you can add multiple versions and configure a traffic ratio. You can use gray launch to smoothly upgrade the model version.                                                                                                                            |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | .. note::                                                                                                                                                                                                                                                                                           |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    Free compute specifications do not support the gray launch of multiple versions.                                                                                                                                                                                                                 |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | WebSocket                     | ``-``                               | Whether to deploy a real-time service as a WebSocket service.                                                                                                                                                                                                                                       |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     | .. note::                                                                                                                                                                                                                                                                                           |
         |                               |                                     |                                                                                                                                                                                                                                                                                                     |
         |                               |                                     |    -  This function is supported only if the model is WebSocket-compliant and comes from a container image.                                                                                                                                                                                         |
         |                               |                                     |    -  After this function is enabled, **Traffic Limit** and **Data Collection** cannot be set.                                                                                                                                                                                                      |
         |                               |                                     |    -  This parameter cannot be changed after the service is deployed.                                                                                                                                                                                                                               |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
         | Data Collection               | N/A                                 | This function is disabled by default. When enabled, it collects and stores data generated when a real-time service is called based on configured rules.                                                                                                                                             |
         +-------------------------------+-------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#. After confirming the entered information, complete service deployment as prompted. Generally, service deployment jobs run for a period of time, which may be several minutes or tens of minutes depending on the amount of your selected data and resources.

   .. note::

      After a real-time service is deployed, it is started immediately.

   In the real-time service list, after the status of the newly deployed service changes from **Deploying** to **Running**, the service is deployed successfully.
